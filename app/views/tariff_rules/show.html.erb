<p style="color: green"><%= notice %></p>

<%= render @tariff_rule %>

<div>
  <%= link_to "Edit this tariff rule", edit_tariff_rule_path(@tariff_rule) %> |
  <%= link_to "Back to tariff rules", tariff_rules_path %>

  <%= button_to "Destroy this tariff rule", @tariff_rule, method: :delete %>
</div>

<hr>

<h2>Duty Calculator</h2>
<p>
  Estimate the US Import Duty for this HTS (tariff) code by entering the declared customs value
  Heliladder would use when bringing this part into the United States.
</p>

<%= form_with url: tariff_rule_path(@tariff_rule), method: :get, local: true do |form| %>
  <div>
    <%= form.label :declared_value, "Declared Customs Value" %><br>
    <%= form.number_field :declared_value,
                          value: params[:declared_value],
                          step: 0.01 %>
  </div>

  <div>
    <%= form.submit "Calculate Duty" %>
  </div>
<% end %>

<% if params[:declared_value].present? %>
  <% declared_value = BigDecimal(params[:declared_value]) rescue nil %>

 <% if declared_value %>
    <% duty = @tariff_rule.duty_for(declared_value) %>
    <% landed_cost = declared_value + duty %>

    <p>
      Duty on
      <%= number_to_currency(declared_value) %>
      is
      <%= number_to_currency(duty) %>.
    </p>

    <h3>Landed cost summary</h3>
    <ul>
      <li>Product value: <%= number_to_currency(declared_value) %></li>
      <li>Duty: <%= number_to_currency(duty) %></li>
      <li><strong>Total landed cost: <%= number_to_currency(landed_cost) %></strong></li>
    </ul>
  <% else %>
    <p>Could not understand that value.</p>
  <% end %>
<% end %>